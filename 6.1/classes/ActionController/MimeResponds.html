<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ActionController::MimeResponds | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="ActionController::MimeResponds" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/6.1/classes/ActionController/MimeResponds.html" />
<meta property="og:url" content="https://railsdoc.github.io/6.1/classes/ActionController/MimeResponds.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="ActionController::MimeResponds" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"ActionController::MimeResponds","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/6.1/classes/ActionController/MimeResponds.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/6.1/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v6.1
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="/">v7.0</a>
            
              
              <a class="dropdown-item" href="/6.1/">v6.1</a>
            
              
              <a class="dropdown-item" href="/6.0/">v6.0</a>
            
              
              <a class="dropdown-item" href="/5.2/">v5.2</a>
            
          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#namespace">Namespace</a>
<ul>
<li class="toc-entry toc-h3"><a href="#class">Class</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#instance-public-methods">Instance Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-i-respond_to">
            
              respond_to(*mimes)
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 6.1.7</span><br />
        
        <div class="type">Module</div>
        <h1>
            ActionController::MimeResponds
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/actionpack/lib/action_controller/metal/mime_responds_rb.html">actionpack/lib/action_controller/metal/mime_responds.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  

  

  
  


  
    <h2 id="namespace">Namespace</h2>

    

    
      <h3 id="class">Class</h3>
      <ul>
      
        <li><a href="MimeResponds/Collector.html">ActionController::MimeResponds::Collector</a></li>
      
      </ul>
    
  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-respond_to">respond_to</a>
        </li>
      
    </ul>
  

  

  
    

    

    

    

    <!-- Methods -->
    
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-respond_to">
            
              respond_to(*mimes)
            
          </h3>

          
            <div class="description">
              <p>Without web-service support, an action which collects the data for displaying a list of people might look something like this:</p>

<pre><code>def index
  @people = Person.all
end
</code></pre>

<p>That action implicitly responds to all formats, but formats can also be explicitly enumerated:</p>

<pre><code>def index
  @people = Person.all
  respond_to :html, :js
end
</code></pre>

<p>Here&#39;s the same action, with web-service support baked in:</p>

<pre><code>def index
  @people = Person.all

  respond_to do |format|
    format.html
    format.js
    format.xml { render xml: @people }
  end
end
</code></pre>

<p>What that says is, “if the client wants HTML or JS in response to this action, just respond as we would have before, but if the client wants XML, return them the list of people in XML format.” (Rails determines the desired response format from the HTTP Accept header submitted by the client.)</p>

<p>Supposing you have an action that adds a new person, optionally creating their company (by name) if it does not already exist, without web-services, it might look like this:</p>

<pre><code>def create
  @company = Company.find_or_create_by(name: params[:company][:name])
  @person  = @company.people.create(params[:person])

  redirect_to(person_list_url)
end
</code></pre>

<p>Here&#39;s the same action, with web-service support baked in:</p>

<pre><code>def create
  company  = params[:person].delete(:company)
  @company = Company.find_or_create_by(name: company[:name])
  @person  = @company.people.create(params[:person])

  respond_to do |format|
    format.html { redirect_to(person_list_url) }
    format.js
    format.xml  { render xml: @person.to_xml(include: @company) }
  end
end
</code></pre>

<p>If the client wants HTML, we just redirect them back to the person list. If they want JavaScript, then it is an Ajax request and we render the JavaScript template associated with this action. Lastly, if the client wants XML, we render the created person as XML, but with a twist: we also include the person&#39;s company in the rendered XML, so you get something like this:</p>

<pre><code>&lt;person&gt;
  &lt;id&gt;...&lt;/id&gt;
  ...
  &lt;company&gt;
    &lt;id&gt;...&lt;/id&gt;
    &lt;name&gt;...&lt;/name&gt;
    ...
  &lt;/company&gt;
&lt;/person&gt;
</code></pre>

<p>Note, however, the extra bit at the top of that action:</p>

<pre><code>company  = params[:person].delete(:company)
@company = Company.find_or_create_by(name: company[:name])
</code></pre>

<p>This is because the incoming XML document (if a web-service request is in process) can only contain a single root-node. So, we have to rearrange things so that the request looks like this (url-encoded):</p>

<pre><code>person[name]=...&amp;person[company][name]=...&amp;...
</code></pre>

<p>And, like this (xml-encoded):</p>

<pre><code>&lt;person&gt;
  &lt;name&gt;...&lt;/name&gt;
  &lt;company&gt;
    &lt;name&gt;...&lt;/name&gt;
  &lt;/company&gt;
&lt;/person&gt;
</code></pre>

<p>In other words, we make the request so that it operates on a single entity&#39;s person. Then, in the action, we extract the company data from the request, find or create the company, and then create the new person with the remaining data.</p>

<p>Note that you can define your own XML parameter parser which would allow you to describe multiple entities in a single request (i.e., by wrapping them all in a single root node), but if you just go with the flow and accept Rails&#39; defaults, life will be much easier.</p>

<p>If you need to use a MIME type which isn&#39;t supported by default, you can register your own handlers in <code>config/initializers/mime_types.rb</code> as follows.</p>

<pre><code>Mime::Type.register &quot;image/jpg&quot;, :jpg
</code></pre>

<p><code>respond_to</code> also allows you to specify a common block for different formats by using <code>any</code>:</p>

<pre><code>def index
  @people = Person.all

  respond_to do |format|
    format.html
    format.any(:xml, :json) { render request.format.to_sym =&gt; @people }
  end
end
</code></pre>

<p>In the example above, if the format is xml, it will render:</p>

<pre><code>render xml: @people
</code></pre>

<p>Or if the format is json:</p>

<pre><code>render json: @people
</code></pre>

<p><code>any</code> can also be used with no arguments, in which case it will be used for any format requested by the user:</p>

<pre><code>respond_to do |format|
  format.html
  format.any { redirect_to support_path }
end
</code></pre>

<p>Formats can have different variants.</p>

<p>The request variant is a specialization of the request format, like <code>:tablet</code>, <code>:phone</code>, or <code>:desktop</code>.</p>

<p>We often want to render different html/json/xml templates for phones, tablets, and desktop browsers. Variants make it easy.</p>

<p>You can set the variant in a <code>before_action</code>:</p>

<pre><code>request.variant = :tablet if /iPad/.match?(request.user_agent)
</code></pre>

<p>Respond to variants in the action just like you respond to formats:</p>

<pre><code>respond_to do |format|
  format.html do |variant|
    variant.tablet # renders app/views/projects/show.html+tablet.erb
    variant.phone { extra_setup; render ... }
    variant.none  { special_setup } # executed only if there is no variant set
  end
end
</code></pre>

<p>Provide separate templates for each format and variant:</p>

<pre><code>app/views/projects/show.html.erb
app/views/projects/show.html+tablet.erb
app/views/projects/show.html+phone.erb
</code></pre>

<p>When you&#39;re not sharing any code within the format, you can simplify defining variants using the inline syntax:</p>

<pre><code>respond_to do |format|
  format.js         { render &quot;trash&quot; }
  format.html.phone { redirect_to progress_path }
  format.html.none  { render &quot;trash&quot; }
end
</code></pre>

<p>Variants also support common <code>any</code>/<code>all</code> block that formats have.</p>

<p>It works for both inline:</p>

<pre><code>respond_to do |format|
  format.html.any   { render html: &quot;any&quot;   }
  format.html.phone { render html: &quot;phone&quot; }
end
</code></pre>

<p>and block syntax:</p>

<pre><code>respond_to do |format|
  format.html do |variant|
    variant.any(:tablet, :phablet){ render html: &quot;any&quot; }
    variant.phone { render html: &quot;phone&quot; }
  end
end
</code></pre>

<p>You can also set an array of variants:</p>

<pre><code>request.variant = [:tablet, :phone]
</code></pre>

<p>This will work similarly to formats and MIME types negotiation. If there is no <code>:tablet</code> variant declared, the <code>:phone</code> variant will be used:</p>

<pre><code>respond_to do |format|
  format.html.none
  format.html.phone # this gets rendered
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-respond_to_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/action_controller/metal/mime_responds.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">respond_to</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mimes</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;respond_to takes either types or a block, never both&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mimes</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-identifier">collector</span> = <span class="ruby-constant">Collector</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mimes</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">variant</span>)
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">collector</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">format</span> = <span class="ruby-identifier">collector</span>.<span class="ruby-identifier">negotiate_format</span>(<span class="ruby-identifier">request</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">media_type</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">media_type</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">format</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">RespondToMismatchError</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">_process_format</span>(<span class="ruby-identifier">format</span>)
    <span class="ruby-identifier">_set_rendered_content_type</span>(<span class="ruby-identifier">format</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">collector</span>.<span class="ruby-identifier">any_response?</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-identifier">collector</span>.<span class="ruby-identifier">response</span>
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownFormat</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
