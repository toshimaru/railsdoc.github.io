<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ActionMailbox::Base | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="ActionMailbox::Base" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/6.1/classes/ActionMailbox/Base.html" />
<meta property="og:url" content="https://railsdoc.github.io/6.1/classes/ActionMailbox/Base.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="ActionMailbox::Base" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"ActionMailbox::Base","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/6.1/classes/ActionMailbox/Base.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/6.1/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v6.1
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            
    
    
    
        <a class="dropdown-item" href="/">v7.1</a>
    

    
    
    
        <a class="dropdown-item" href="/7.0/">v7.0</a>
    

    
    
    
        <a class="dropdown-item" href="/6.1/">v6.1</a>
    

    
    
    
        <a class="dropdown-item" href="/6.0/">v6.0</a>
    

    
    
    
        <a class="dropdown-item" href="/5.2/">v5.2</a>
    


          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#included-modules">Included Modules</a></li>
<li class="toc-entry toc-h2"><a href="#attributes">Attributes</a></li>
<li class="toc-entry toc-h2"><a href="#class-public-methods">Class Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-c-new">
            
              new(inbound_email)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-c-receive">
            
              receive(inbound_email)
            
          </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#instance-public-methods">Instance Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-i-bounce_with">
            
              bounce_with(message)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-process">
            
              process()
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 6.1.7</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActionMailbox::Base
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/actionmailbox/lib/action_mailbox/base_rb.html">actionmailbox/lib/action_mailbox/base.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>The base class for all application mailboxes. Not intended to be inherited from directly. Inherit from <code>ApplicationMailbox</code> instead, as that&#39;s where the app-specific routing is configured. This routing is specified in the following ways:</p>

<pre><code>class ApplicationMailbox &lt; ActionMailbox::Base
  # Any of the recipients of the mail (whether to, cc, bcc) are matched against the regexp.
  routing /^replies@/i =&gt; :replies

  # Any of the recipients of the mail (whether to, cc, bcc) needs to be an exact match for the string.
  routing &quot;help@example.com&quot; =&gt; :help

  # Any callable (proc, lambda, etc) object is passed the inbound_email record and is a match if true.
  routing -&gt;(inbound_email) { inbound_email.mail.to.size &gt; 2 } =&gt; :multiple_recipients

  # Any object responding to #match? is called with the inbound_email record as an argument. Match if true.
  routing CustomAddress.new =&gt; :custom

  # Any inbound_email that has not been already matched will be sent to the BackstopMailbox.
  routing :all =&gt; :backstop
end
</code></pre>

<p>Application mailboxes need to overwrite the <code>#process</code> method, which is invoked by the framework after callbacks have been run. The callbacks available are: <code>before_processing</code>, <code>after_processing</code>, and <code>around_processing</code>. The primary use case is ensure certain preconditions to processing are fulfilled using <code>before_processing</code> callbacks.</p>

<p>If a precondition fails to be met, you can halt the processing using the <code>#bounced!</code> method, which will silently prevent any further processing, but not actually send out any bounce notice. You can also pair this behavior with the invocation of an Action Mailer class responsible for sending out an actual bounce email. This is done using the <code>#bounce_with</code> method, which takes the mail object returned by an Action Mailer method, like so:</p>

<pre><code>class ForwardsMailbox &lt; ApplicationMailbox
  before_processing :ensure_sender_is_a_user

  private
    def ensure_sender_is_a_user
      unless User.exist?(email_address: mail.from)
        bounce_with UserRequiredMailer.missing(inbound_email)
      end
    end
end
</code></pre>

<p>During the processing of the inbound email, the status will be tracked. Before processing begins, the email will normally have the <code>pending</code> status. Once processing begins, just before callbacks and the <code>#process</code> method is called, the status is changed to <code>processing</code>. If processing is allowed to complete, the status is changed to <code>delivered</code>. If a bounce is triggered, then <code>bounced</code>. If an unhandled exception is bubbled up, then <code>failed</code>.</p>

<p>Exceptions can be handled at the class level using the familiar <code>Rescuable</code> approach:</p>

<pre><code>class ForwardsMailbox &lt; ApplicationMailbox
  rescue_from(ApplicationSpecificVerificationError) { bounced! }
end
</code></pre>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-bounce_with">bounce_with</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
        <li>
          <a href="#method-i-process">process</a>
        </li>
      
        <li>
          <a href="#method-c-receive">receive</a>
        </li>
      
    </ul>
  

  
    <!-- Includes -->
    <h2 id="included-modules">Included Modules</h2>
    <ul>
      
        <li>
          
            <a href="../ActiveSupport/Rescuable.html">
              ActiveSupport::Rescuable
            </a>
          
        </li>
      
    </ul>
  

  
    

    

    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>inbound_email</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-new">
            
              new(inbound_email)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-c-new_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionmailbox/lib/action_mailbox/base.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">inbound_email</span>)
  <span class="ruby-ivar">@inbound_email</span> = <span class="ruby-identifier">inbound_email</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-c-receive">
            
              receive(inbound_email)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-c-receive_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionmailbox/lib/action_mailbox/base.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">receive</span>(<span class="ruby-identifier">inbound_email</span>)
  <span class="ruby-identifier">new</span>(<span class="ruby-identifier">inbound_email</span>).<span class="ruby-identifier">perform_processing</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-bounce_with">
            
              bounce_with(message)
            
          </h3>

          
            <div class="description">
              <p>Enqueues the given <code>message</code> for delivery and changes the inbound email&#39;s status to <code>:bounced</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-bounce_with_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionmailbox/lib/action_mailbox/base.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bounce_with</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-identifier">inbound_email</span>.<span class="ruby-identifier">bounced!</span>
  <span class="ruby-identifier">message</span>.<span class="ruby-identifier">deliver_later</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-process">
            
              process()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-process_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionmailbox/lib/action_mailbox/base.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process</span>
  <span class="ruby-comment"># Overwrite in subclasses</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js" integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
