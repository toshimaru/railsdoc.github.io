<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ERB::Util | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="ERB::Util" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/classes/ERB/Util.html" />
<meta property="og:url" content="https://railsdoc.github.io/classes/ERB/Util.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="ERB::Util" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"ERB::Util","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/classes/ERB/Util.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v7.1
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            
    
    
    
        <a class="dropdown-item" href="/">v7.1</a>
    

    
    
    
        <a class="dropdown-item" href="/7.0/">v7.0</a>
    

    
    
    
        <a class="dropdown-item" href="/6.1/">v6.1</a>
    

    
    
    
        <a class="dropdown-item" href="/6.0/">v6.0</a>
    

    
    
    
        <a class="dropdown-item" href="/5.2/">v5.2</a>
    


          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#constants">Constants</a></li>
<li class="toc-entry toc-h2"><a href="#class-public-methods">Class Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-c-html_escape_once">
            
              html_escape_once(s)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-c-json_escape">
            
              json_escape(s)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-c-xml_name_escape">
            
              xml_name_escape(name)
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 7.1.0</span><br />
        
        <div class="type">Module</div>
        <h1>
            ERB::Util
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activesupport/lib/active_support/core_ext/erb/util_rb.html">activesupport/lib/active_support/core_ext/erb/util.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-c-html_escape_once">html_escape_once</a>
        </li>
      
        <li>
          <a href="#method-c-json_escape">json_escape</a>
        </li>
      
        <li>
          <a href="#method-c-xml_name_escape">xml_name_escape</a>
        </li>
      
    </ul>
  

  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">HTML_ESCAPE</td>
            <td>=</td>
            <td class="attr-value">{ &quot;&amp;&quot; =&gt; &quot;&amp;amp;&quot;,  &quot;&gt;&quot; =&gt; &quot;&amp;gt;&quot;,   &quot;&lt;&quot; =&gt; &quot;&amp;lt;&quot;, &#39;&quot;&#39; =&gt; &quot;&amp;quot;&quot;, &quot;&#39;&quot; =&gt; &quot;&amp;#39;&quot; }</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HTML_ESCAPE_ONCE_REGEXP</td>
            <td>=</td>
            <td class="attr-value">/[&quot;&gt;&lt;&#39;]|&amp;(?!([a-zA-Z]+|(#\d+)|(#[xX][\dA-Fa-f]+));)/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">INVALID_TAG_NAME_FOLLOWING_REGEXP</td>
            <td>=</td>
            <td class="attr-value">/[^#{TAG_NAME_FOLLOWING_CODEPOINTS}]/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">INVALID_TAG_NAME_START_REGEXP</td>
            <td>=</td>
            <td class="attr-value">/[^#{TAG_NAME_START_CODEPOINTS}]/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SAFE_XML_TAG_NAME_REGEXP</td>
            <td>=</td>
            <td class="attr-value">/\A[#{TAG_NAME_START_CODEPOINTS}][#{TAG_NAME_FOLLOWING_CODEPOINTS}]*\z/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">TAG_NAME_FOLLOWING_CODEPOINTS</td>
            <td>=</td>
            <td class="attr-value">&quot;#{TAG_NAME_START_CODEPOINTS}\\-.0-9\u{B7}\u{0300}-\u{036F}\u{203F}-\u{2040}&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">TAG_NAME_REPLACEMENT_CHAR</td>
            <td>=</td>
            <td class="attr-value">&quot;_&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">TAG_NAME_START_CODEPOINTS</td>
            <td>=</td>
            <td class="attr-value">&quot;@:A-Z_a-z\u{C0}-\u{D6}\u{D8}-\u{F6}\u{F8}-\u{2FF}\u{370}-\u{37D}\u{37F}-\u{1FFF}&quot; \
&quot;\u{200C}-\u{200D}\u{2070}-\u{218F}\u{2C00}-\u{2FEF}\u{3001}-\u{D7FF}\u{F900}-\u{FDCF}&quot; \
&quot;\u{FDF0}-\u{FFFD}\u{10000}-\u{EFFFF}&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Following XML requirements: <a href="https://www.w3.org/TR/REC-xml/#NT-Name">www.w3.org/TR/REC-xml/#NT-Name</a></p></td>
            </tr>
          
        
      </table>
    

    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-html_escape_once">
            
              html_escape_once(s)
            
          </h3>

          
            <div class="description">
              <p>A utility method for escaping HTML without affecting existing escaped entities.</p>

<pre><code>html_escape_once(&#39;1 &lt; 2 &amp;amp; 3&#39;)
# =&gt; &quot;1 &amp;lt; 2 &amp;amp; 3&quot;

html_escape_once(&#39;&amp;lt;&amp;lt; Accept &amp; Checkout&#39;)
# =&gt; &quot;&amp;lt;&amp;lt; Accept &amp;amp; Checkout&quot;
</code></pre>
            </div>
          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">Source code</span>
              </summary>

              <pre><code class="ruby"># File activesupport/lib/active_support/core_ext/erb/util.rb, line 63
    def html_escape_once(s)
      ActiveSupport::Multibyte::Unicode.tidy_bytes(s.to_s).gsub(HTML_ESCAPE_ONCE_REGEXP, HTML_ESCAPE).html_safe
    end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/d39db5d1891f7509cde2efc425c9d69bbb77e670/activesupport/lib/active_support/core_ext/erb/util.rb#L63" target="_blank" class="github_url">See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-json_escape">
            
              json_escape(s)
            
          </h3>

          
            <div class="description">
              <p>A utility method for escaping HTML entities in JSON strings. Specifically, the &amp;, &gt; and &lt; characters are replaced with their equivalent unicode escaped form - u0026, u003e, and u003c. The Unicode sequences u2028 and u2029 are also escaped as they are treated as newline characters in some JavaScript engines. These sequences have identical meaning as the original characters inside the context of a JSON string, so assuming the input is a valid and well-formed JSON value, the output will have equivalent meaning when parsed:</p>

<pre><code>json = JSON.generate({ name: &quot;&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;&quot;})
# =&gt; &quot;{\&quot;name\&quot;:\&quot;&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;\&quot;}&quot;

json_escape(json)
# =&gt; &quot;{\&quot;name\&quot;:\&quot;\\u003C/script\\u003E\\u003Cscript\\u003Ealert(&#39;PWNED!!!&#39;)\\u003C/script\\u003E\&quot;}&quot;

JSON.parse(json) == JSON.parse(json_escape(json))
# =&gt; true
</code></pre>

<p>The intended use case for this method is to escape JSON strings before including them inside a script tag to avoid XSS vulnerability:</p>

<pre><code>&lt;script&gt;
  var currentUser = &lt;%= raw json_escape(current_user.to_json) %&gt;;
&lt;/script&gt;
</code></pre>

<p>It is necessary to <code>raw</code> the result of <code>json_escape</code>, so that quotation marks don’t get converted to <code>&amp;quot;</code> entities. <code>json_escape</code> doesn’t automatically flag the result as HTML safe, since the raw value is unsafe to use inside HTML attributes.</p>

<p>If your JSON is being used downstream for insertion into the DOM, be aware of whether or not it is being inserted via <code>html()</code>. Most jQuery plugins do this. If that is the case, be sure to <code>html_escape</code> or <code>sanitize</code> any user-generated content returned by your JSON.</p>

<p>If you need to output JSON elsewhere in your HTML, you can just do something like this, as any unsafe characters (including quotation marks) will be automatically escaped for you:</p>

<pre><code>&lt;div data-user-info=&quot;&lt;%= current_user.to_json %&gt;&quot;&gt;...&lt;/div&gt;
</code></pre>

<p>WARNING: this helper only works with valid JSON. Using this on non-JSON values will open up serious XSS vulnerabilities. For example, if you replace the <code>current_user.to_json</code> in the example above with user input instead, the browser will happily <code>eval()</code> that string as JavaScript.</p>

<p>The escaping performed in this method is identical to those performed in the Active Support JSON encoder when <code>ActiveSupport.escape_html_entities_in_json</code> is set to true. Because this transformation is idempotent, this helper can be applied even if <code>ActiveSupport.escape_html_entities_in_json</code> is already true.</p>

<p>Therefore, when you are unsure if <code>ActiveSupport.escape_html_entities_in_json</code> is enabled, or if you are unsure where your JSON string originated from, it is recommended that you always apply this helper (other libraries, such as the JSON gem, do not provide this kind of protection by default; also some gems might override <code>to_json</code> to bypass Active Support’s encoder).</p>
            </div>
          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">Source code</span>
              </summary>

              <pre><code class="ruby"># File activesupport/lib/active_support/core_ext/erb/util.rb, line 124
    def json_escape(s)
      result = s.to_s.dup
      result.gsub!(">", '\u003e')
      result.gsub!("<", '\u003c')
      result.gsub!("&", '\u0026')
      result.gsub!("\u2028", '\u2028')
      result.gsub!("\u2029", '\u2029')
      s.html_safe? ? result.html_safe : result
    end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/d39db5d1891f7509cde2efc425c9d69bbb77e670/activesupport/lib/active_support/core_ext/erb/util.rb#L124" target="_blank" class="github_url">See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-xml_name_escape">
            
              xml_name_escape(name)
            
          </h3>

          
            <div class="description">
              <p>A utility method for escaping XML names of tags and names of attributes.</p>

<pre><code>xml_name_escape(&#39;1 &lt; 2 &amp; 3&#39;)
# =&gt; &quot;1___2___3&quot;
</code></pre>

<p>It follows the requirements of the specification: <a href="https://www.w3.org/TR/REC-xml/#NT-Name">www.w3.org/TR/REC-xml/#NT-Name</a></p>
            </div>
          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">Source code</span>
              </summary>

              <pre><code class="ruby"># File activesupport/lib/active_support/core_ext/erb/util.rb, line 142
    def xml_name_escape(name)
      name = name.to_s
      return "" if name.blank?
      return name if name.match?(SAFE_XML_TAG_NAME_REGEXP)

      starting_char = name[0]
      starting_char.gsub!(INVALID_TAG_NAME_START_REGEXP, TAG_NAME_REPLACEMENT_CHAR)

      return starting_char if name.size == 1

      following_chars = name[1..-1]
      following_chars.gsub!(INVALID_TAG_NAME_FOLLOWING_REGEXP, TAG_NAME_REPLACEMENT_CHAR)

      starting_char << following_chars
    end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/d39db5d1891f7509cde2efc425c9d69bbb77e670/activesupport/lib/active_support/core_ext/erb/util.rb#L142" target="_blank" class="github_url">See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js" integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
