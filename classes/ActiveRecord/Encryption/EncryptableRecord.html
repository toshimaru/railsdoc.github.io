<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ActiveRecord::Encryption::EncryptableRecord | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="ActiveRecord::Encryption::EncryptableRecord" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/classes/ActiveRecord/Encryption/EncryptableRecord.html" />
<meta property="og:url" content="https://railsdoc.github.io/classes/ActiveRecord/Encryption/EncryptableRecord.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="ActiveRecord::Encryption::EncryptableRecord" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"ActiveRecord::Encryption::EncryptableRecord","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/classes/ActiveRecord/Encryption/EncryptableRecord.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v7.0
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="/">v7.0</a>
            
              
              <a class="dropdown-item" href="/6.1/">v6.1</a>
            
              
              <a class="dropdown-item" href="/6.0/">v6.0</a>
            
              
              <a class="dropdown-item" href="/5.2/">v5.2</a>
            
          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#constants">Constants</a></li>
<li class="toc-entry toc-h2"><a href="#instance-public-methods">Instance Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-i-add_length_validation_for_encrypted_columns">
            
              add_length_validation_for_encrypted_columns()
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-ciphertext_for">
            
              ciphertext_for(attribute_name)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-decrypt">
            
              decrypt()
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-deterministic_encrypted_attributes">
            
              deterministic_encrypted_attributes()
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-encrypt">
            
              encrypt()
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-encrypt_attribute">
            
              encrypt_attribute(name, attribute_scheme)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-encrypted_attribute-3F">
            
              encrypted_attribute?(attribute_name)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-encrypts">
            
              encrypts(*names, key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-encrypts-label-Options">Options</a></li>
<li class="toc-entry toc-h3"><a href="#method-i-global_previous_schemes_for">
            
              global_previous_schemes_for(scheme)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-load_schema-21">
            
              load_schema!()
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-override_accessors_to_preserve_original">
            
              override_accessors_to_preserve_original(name, original_attribute_name)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-preserve_original_encrypted">
            
              preserve_original_encrypted(name)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-scheme_for">
            
              scheme_for(key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-source_attribute_from_preserved_attribute">
            
              source_attribute_from_preserved_attribute(attribute_name)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-validate_column_size">
            
              validate_column_size(attribute_name)
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 7.0.4</span><br />
        
        <div class="type">Module</div>
        <h1>
            ActiveRecord::Encryption::EncryptableRecord
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/encryption/encryptable_record_rb.html">activerecord/lib/active_record/encryption/encryptable_record.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This is the concern mixed in Active Record models to make them encryptable. It adds the <code>encrypts</code> attribute declaration, as well as the API to encrypt and decrypt records.</p>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-add_length_validation_for_encrypted_columns">add_length_validation_for_encrypted_columns</a>
        </li>
      
        <li>
          <a href="#method-i-ciphertext_for">ciphertext_for</a>
        </li>
      
        <li>
          <a href="#method-i-decrypt">decrypt</a>
        </li>
      
        <li>
          <a href="#method-i-deterministic_encrypted_attributes">deterministic_encrypted_attributes</a>
        </li>
      
        <li>
          <a href="#method-i-encrypt">encrypt</a>
        </li>
      
        <li>
          <a href="#method-i-encrypt_attribute">encrypt_attribute</a>
        </li>
      
        <li>
          <a href="#method-i-encrypted_attribute-3F">encrypted_attribute?</a>
        </li>
      
        <li>
          <a href="#method-i-encrypts">encrypts</a>
        </li>
      
        <li>
          <a href="#method-i-global_previous_schemes_for">global_previous_schemes_for</a>
        </li>
      
        <li>
          <a href="#method-i-load_schema-21">load_schema!</a>
        </li>
      
        <li>
          <a href="#method-i-override_accessors_to_preserve_original">override_accessors_to_preserve_original</a>
        </li>
      
        <li>
          <a href="#method-i-preserve_original_encrypted">preserve_original_encrypted</a>
        </li>
      
        <li>
          <a href="#method-i-scheme_for">scheme_for</a>
        </li>
      
        <li>
          <a href="#method-i-source_attribute_from_preserved_attribute">source_attribute_from_preserved_attribute</a>
        </li>
      
        <li>
          <a href="#method-i-validate_column_size">validate_column_size</a>
        </li>
      
    </ul>
  

  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ORIGINAL_ATTRIBUTE_PREFIX</td>
            <td>=</td>
            <td class="attr-value">&quot;original_&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    

    

    <!-- Methods -->
    
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-add_length_validation_for_encrypted_columns">
            
              add_length_validation_for_encrypted_columns()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-add_length_validation_for_encrypted_columns_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_length_validation_for_encrypted_columns</span>
  <span class="ruby-identifier">encrypted_attributes</span>&amp;.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">validate_column_size</span> <span class="ruby-identifier">attribute_name</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-ciphertext_for">
            
              ciphertext_for(attribute_name)
            
          </h3>

          
            <div class="description">
              <p>Returns the ciphertext for <code>attribute_name</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-ciphertext_for_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ciphertext_for</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-identifier">read_attribute_before_type_cast</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-decrypt">
            
              decrypt()
            
          </h3>

          
            <div class="description">
              <p>Decrypts all the encryptable attributes and saves the changes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-decrypt_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">decrypt</span>
  <span class="ruby-identifier">decrypt_attributes</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_encrypted_attributes?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-deterministic_encrypted_attributes">
            
              deterministic_encrypted_attributes()
            
          </h3>

          
            <div class="description">
              <p>Returns the list of deterministic encryptable attributes in the model class.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-deterministic_encrypted_attributes_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deterministic_encrypted_attributes</span>
  <span class="ruby-ivar">@deterministic_encrypted_attributes</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">encrypted_attributes</span>&amp;.<span class="ruby-identifier">find_all</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">type_for_attribute</span>(<span class="ruby-identifier">attribute_name</span>).<span class="ruby-identifier">deterministic?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-encrypt">
            
              encrypt()
            
          </h3>

          
            <div class="description">
              <p>Encrypts all the encryptable attributes and saves the changes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-encrypt_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypt</span>
  <span class="ruby-identifier">encrypt_attributes</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_encrypted_attributes?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-encrypt_attribute">
            
              encrypt_attribute(name, attribute_scheme)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-encrypt_attribute_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypt_attribute</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">attribute_scheme</span>)
  <span class="ruby-identifier">encrypted_attributes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">attribute</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cast_type</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedAttributeType</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">scheme:</span> <span class="ruby-identifier">attribute_scheme</span>, <span class="ruby-value">cast_type:</span> <span class="ruby-identifier">cast_type</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">preserve_original_encrypted</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">attribute_scheme</span>.<span class="ruby-identifier">ignore_case?</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">encrypted_attribute_was_declared</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-encrypted_attribute-3F">
            
              encrypted_attribute?(attribute_name)
            
          </h3>

          
            <div class="description">
              <p>Returns whether a given attribute is encrypted or not.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-encrypted_attribute-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypted_attribute?</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">encryptor</span>.<span class="ruby-identifier">encrypted?</span> <span class="ruby-identifier">ciphertext_for</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-encrypts">
            
              encrypts(*names, key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
          </h3>

          
            <div class="description">
              <p>Encrypts the <code>name</code> attribute.</p>

<h3 id="method-i-encrypts-label-Options">Options</h3>
<ul><li>
<p><code>:key_provider</code> - A key provider to provide encryption and decryption keys. Defaults to <code>ActiveRecord::Encryption.key_provider</code>.</p>
</li><li>
<p><code>:key</code> - A password to derive the key from. It&#39;s a shorthand for a <code>:key_provider</code> that serves derivated keys. Both options can&#39;t be used at the same time.</p>
</li><li>
<p><code>:deterministic</code> - By default, encryption is not deterministic. It will use a random initialization vector for each encryption operation. This means that encrypting the same content with the same key twice will generate different ciphertexts. When set to <code>true</code>, it will generate the initialization vector based on the encrypted content. This means that the same content will generate the same ciphertexts. This enables querying encrypted text with Active Record. Deterministic encryption will use the oldest encryption scheme to encrypt new data by default. You can change this by setting +deterministic: { fixed: false }+. That will make it use the newest encryption scheme for encrypting new data.</p>
</li><li>
<p><code>:downcase</code> - When true, it converts the encrypted content to downcase automatically. This allows to effectively ignore case when querying data. Notice that the case is lost. Use <code>:ignore_case</code> if you are interested in preserving it.</p>
</li><li>
<p><code>:ignore_case</code> - When true, it behaves like <code>:downcase</code> but, it also preserves the original case in a specially designated column +original_&lt;name&gt;+. When reading the encrypted content, the version with the original case is served. But you can still execute queries that will ignore the case. This option can only be used when <code>:deterministic</code> is true.</p>
</li><li>
<p><code>:context_properties</code> - Additional properties that will override <code>Context</code> settings when this attribute is encrypted and decrypted. E.g: <code>encryptor:</code>, <code>cipher:</code>, <code>message_serializer:</code>, etc.</p>
</li><li>
<p><code>:previous</code> - List of previous encryption schemes. When provided, they will be used in order when trying to read the attribute. Each entry of the list can contain the properties supported by <a href="EncryptableRecord.html#method-i-encrypts"><code>encrypts</code></a>. Also, when deterministic encryption is used, they will be used to generate additional ciphertexts to check in the queries.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-encrypts_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypts</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">names</span>, <span class="ruby-value">key_provider:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">key:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">downcase:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">previous:</span> [], <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encrypted_attributes</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment"># not using :default because the instance would be shared across classes</span>
  <span class="ruby-identifier">scheme</span> = <span class="ruby-identifier">scheme_for</span> <span class="ruby-value">key_provider:</span> <span class="ruby-identifier">key_provider</span>, <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-identifier">deterministic</span>, <span class="ruby-value">downcase:</span> <span class="ruby-identifier">downcase</span>, \
      <span class="ruby-value">ignore_case:</span> <span class="ruby-identifier">ignore_case</span>, <span class="ruby-value">previous:</span> <span class="ruby-identifier">previous</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>

  <span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">encrypt_attribute</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scheme</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-global_previous_schemes_for">
            
              global_previous_schemes_for(scheme)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-global_previous_schemes_for_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">global_previous_schemes_for</span>(<span class="ruby-identifier">scheme</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">previous_schemes</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">previous_scheme</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">previous_scheme</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-load_schema-21">
            
              load_schema!()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-load_schema-21_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_schema!</span>
  <span class="ruby-keyword">super</span>

  <span class="ruby-identifier">add_length_validation_for_encrypted_columns</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">validate_column_size</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-override_accessors_to_preserve_original">
            
              override_accessors_to_preserve_original(name, original_attribute_name)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-override_accessors_to_preserve_original_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">override_accessors_to_preserve_original</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">original_attribute_name</span>)
  <span class="ruby-identifier">include</span>(<span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">define_method</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">value</span> = <span class="ruby-keyword">super</span>()) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">encrypted_attribute?</span>(<span class="ruby-identifier">name</span>)) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">support_unencrypted_data</span>
        <span class="ruby-identifier">send</span>(<span class="ruby-identifier">original_attribute_name</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">define_method</span> <span class="ruby-node">&quot;#{name}=&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span> <span class="ruby-node">&quot;#{original_attribute_name}=&quot;</span>, <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">super</span>(<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-preserve_original_encrypted">
            
              preserve_original_encrypted(name)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-preserve_original_encrypted_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">preserve_original_encrypted</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">original_attribute_name</span> = <span class="ruby-node">&quot;#{ORIGINAL_ATTRIBUTE_PREFIX}#{name}&quot;</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">support_unencrypted_data</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">original_attribute_name</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">Configuration</span>, <span class="ruby-node">&quot;To use :ignore_case for &#39;#{name}&#39; you must create an additional column named &#39;#{original_attribute_name}&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">encrypts</span> <span class="ruby-identifier">original_attribute_name</span>
  <span class="ruby-identifier">override_accessors_to_preserve_original</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">original_attribute_name</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-scheme_for">
            
              scheme_for(key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-scheme_for_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scheme_for</span>(<span class="ruby-value">key_provider:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">key:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">downcase:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">previous:</span> [], <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheme</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">key_provider:</span> <span class="ruby-identifier">key_provider</span>, <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-identifier">deterministic</span>,
                                       <span class="ruby-value">downcase:</span> <span class="ruby-identifier">downcase</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-identifier">ignore_case</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>).<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scheme</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">previous_schemes</span> = <span class="ruby-identifier">global_previous_schemes_for</span>(<span class="ruby-identifier">scheme</span>) <span class="ruby-operator">+</span>
      <span class="ruby-constant">Array</span>.<span class="ruby-identifier">wrap</span>(<span class="ruby-identifier">previous</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">scheme_config</span><span class="ruby-operator">|</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheme</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">scheme_config</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-source_attribute_from_preserved_attribute">
            
              source_attribute_from_preserved_attribute(attribute_name)
            
          </h3>

          
            <div class="description">
              <p>Given a attribute name, it returns the name of the source attribute when it&#39;s a preserved one.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-source_attribute_from_preserved_attribute_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">source_attribute_from_preserved_attribute</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-constant">ORIGINAL_ATTRIBUTE_PREFIX</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-regexp">/^#{ORIGINAL_ATTRIBUTE_PREFIX}/</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-validate_column_size">
            
              validate_column_size(attribute_name)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-validate_column_size_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate_column_size</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit</span> = <span class="ruby-identifier">columns_hash</span>[<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">to_s</span>]&amp;.<span class="ruby-identifier">limit</span>
    <span class="ruby-identifier">validates_length_of</span> <span class="ruby-identifier">attribute_name</span>, <span class="ruby-value">maximum:</span> <span class="ruby-identifier">limit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
