<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AbstractController::Caching::Fragments | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="AbstractController::Caching::Fragments" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/5.2/classes/AbstractController/Caching/Fragments.html" />
<meta property="og:url" content="https://railsdoc.github.io/5.2/classes/AbstractController/Caching/Fragments.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="AbstractController::Caching::Fragments" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"AbstractController::Caching::Fragments","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/5.2/classes/AbstractController/Caching/Fragments.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/5.2/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v5.2
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            
              
              
              
                <a class="dropdown-item" href="/">v7.1</a>
              
            
              
              
              
                <a class="dropdown-item" href="/7.0/">v7.0</a>
              
            
              
              
              
                <a class="dropdown-item" href="/6.1/">v6.1</a>
              
            
              
              
              
                <a class="dropdown-item" href="/6.0/">v6.0</a>
              
            
              
              
              
                <a class="dropdown-item" href="/5.2/">v5.2</a>
              
            
          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#namespace">Namespace</a>
<ul>
<li class="toc-entry toc-h3"><a href="#module">Module</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#instance-public-methods">Instance Public methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-i-combined_fragment_cache_key">
            
              combined_fragment_cache_key(key)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-expire_fragment">
            
              expire_fragment(key, options = nil)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-fragment_cache_key">
            
              fragment_cache_key(key)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-fragment_exist-3F">
            
              fragment_exist?(key, options = nil)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-read_fragment">
            
              read_fragment(key, options = nil)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-write_fragment">
            
              write_fragment(key, content, options = nil)
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 5.2.8</span><br />
        
        <div class="type">Module</div>
        <h1>
            AbstractController::Caching::Fragments
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/actionpack/lib/abstract_controller/caching/fragments_rb.html">actionpack/lib/abstract_controller/caching/fragments.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Fragment caching is used for caching various blocks within views without caching the entire action as a whole. This is useful when certain elements of an action change frequently or depend on complicated state while other parts rarely change or can be shared amongst multiple parties. The caching is done using the <code>cache</code> helper available in the Action View. See <a href="../../ActionView/Helpers/CacheHelper.html"><code>ActionView::Helpers::CacheHelper</code></a> for more information.</p>

<p>While it&#39;s strongly recommended that you use key-based cache expiration (see links in CacheHelper for more information), it is also possible to manually expire caches. For example:</p>

<pre><code>expire_fragment(&#39;name_of_cache&#39;)
</code></pre>

    </div>
  

  

  
  


  
    <h2 id="namespace">Namespace</h2>

    
      <h3 id="module">Module</h3>
      <ul>
      
        <li><a href="Fragments/ClassMethods.html">AbstractController::Caching::Fragments::ClassMethods</a></li>
      
      </ul>
    

    
  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-combined_fragment_cache_key">combined_fragment_cache_key</a>
        </li>
      
        <li>
          <a href="#method-i-expire_fragment">expire_fragment</a>
        </li>
      
        <li>
          <a href="#method-i-fragment_cache_key">fragment_cache_key</a>
        </li>
      
        <li>
          <a href="#method-i-fragment_exist-3F">fragment_exist?</a>
        </li>
      
        <li>
          <a href="#method-i-read_fragment">read_fragment</a>
        </li>
      
        <li>
          <a href="#method-i-write_fragment">write_fragment</a>
        </li>
      
    </ul>
  

  

  
    

    

    

    

    <!-- Methods -->
    
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-combined_fragment_cache_key">
            
              combined_fragment_cache_key(key)
            
          </h3>

          
            <div class="description">
              <p>Given a key (as described in <code>expire_fragment</code>), returns a key array suitable for use in reading, writing, or expiring a cached fragment. All keys begin with <code>:views</code>, followed by <a href=""RAILS_CACHE_ID"">ENV</a> or <a href=""RAILS_APP_VERSION"">ENV</a> if set, followed by any controller-wide key prefix values, ending with the specified <code>key</code> value.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-combined_fragment_cache_key_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">combined_fragment_cache_key</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">head</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">fragment_cache_keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">instance_exec</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">k</span>) }
  <span class="ruby-identifier">tail</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;://&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">key</span>
  [ <span class="ruby-value">:views</span>, (<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;RAILS_CACHE_ID&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;RAILS_APP_VERSION&quot;</span>]), <span class="ruby-operator">*</span><span class="ruby-identifier">head</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">tail</span> ].<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-expire_fragment">
            
              expire_fragment(key, options = nil)
            
          </h3>

          
            <div class="description">
              <p>Removes fragments from the cache.</p>

<p><code>key</code> can take one of three forms:</p>
<ul><li>
<p><a href="../../String.html"><code>String</code></a> - This would normally take the form of a path, like <code>pages/45/notes</code>.</p>
</li><li>
<p><a href="../../Hash.html"><code>Hash</code></a> - Treated as an implicit call to <code>url_for</code>, like <code>{ controller: &#39;pages&#39;, action: &#39;notes&#39;, id: 45}</code></p>
</li><li>
<p>Regexp - Will remove any fragment that matches, so <code>%r{pages/\d*/notes}</code> might remove all notes. Make sure you don&#39;t use anchors in the regex (<code>^</code> or <code>$</code>) because the actual filename matched looks like <code>./cache/filename/path.cache</code>. Note: Regexp expiration is only supported on caches that can iterate over all keys (unlike memcached).</p>
</li></ul>

<p><code>options</code> is passed through to the cache store&#39;s <code>delete</code> method (or <code>delete_matched</code>, for Regexp keys).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-expire_fragment_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expire_fragment</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cache_configured?</span>
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">combined_fragment_cache_key</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)

  <span class="ruby-identifier">instrument_fragment_cache</span> <span class="ruby-value">:expire_fragment</span>, <span class="ruby-identifier">key</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
      <span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">delete_matched</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-fragment_cache_key">
            
              fragment_cache_key(key)
            
          </h3>

          
            <div class="description">
              <p>Given a key (as described in <code>expire_fragment</code>), returns a key suitable for use in reading, writing, or expiring a cached fragment. All keys begin with <code>views/</code>, followed by any controller-wide key prefix values, ending with the specified <code>key</code> value. The key is expanded using <a href="../../ActiveSupport/Cache.html#method-c-expand_cache_key"><code>ActiveSupport::Cache.expand_cache_key</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-fragment_cache_key_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 69</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fragment_cache_key</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">&lt;&lt;-MSG</span>.<span class="ruby-identifier">squish</span>)
<span class="ruby-value">          Calling fragment_cache_key directly is deprecated and will be removed in Rails 6.0.
          All fragment accessors now use the combined_fragment_cache_key method that retains the key as an array,
          such that the caching stores can interrogate the parts for cache versions used in
          recyclable cache keys.
</span><span class="ruby-identifier">        MSG</span>

        <span class="ruby-identifier">head</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">fragment_cache_keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">instance_exec</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">k</span>) }
        <span class="ruby-identifier">tail</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;://&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">key</span>
        <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>.<span class="ruby-identifier">expand_cache_key</span>([<span class="ruby-operator">*</span><span class="ruby-identifier">head</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">tail</span>], <span class="ruby-value">:views</span>)
      <span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-fragment_exist-3F">
            
              fragment_exist?(key, options = nil)
            
          </h3>

          
            <div class="description">
              <p>Check if a cached fragment from the location signified by <code>key</code> exists (see <code>expire_fragment</code> for acceptable formats).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-fragment_exist-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fragment_exist?</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cache_configured?</span>
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">combined_fragment_cache_key</span>(<span class="ruby-identifier">key</span>)

  <span class="ruby-identifier">instrument_fragment_cache</span> <span class="ruby-value">:exist_fragment?</span>, <span class="ruby-identifier">key</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-read_fragment">
            
              read_fragment(key, options = nil)
            
          </h3>

          
            <div class="description">
              <p>Reads a cached fragment from the location signified by <code>key</code> (see <code>expire_fragment</code> for acceptable formats).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-read_fragment_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_fragment</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cache_configured?</span>

  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">combined_fragment_cache_key</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">instrument_fragment_cache</span> <span class="ruby-value">:read_fragment</span>, <span class="ruby-identifier">key</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:html_safe</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">html_safe</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-write_fragment">
            
              write_fragment(key, content, options = nil)
            
          </h3>

          
            <div class="description">
              <p>Writes <code>content</code> to the location signified by <code>key</code> (see <code>expire_fragment</code> for acceptable formats).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-write_fragment_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/abstract_controller/caching/fragments.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write_fragment</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">content</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cache_configured?</span>

  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">combined_fragment_cache_key</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">instrument_fragment_cache</span> <span class="ruby-value">:write_fragment</span>, <span class="ruby-identifier">key</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">content</span> = <span class="ruby-identifier">content</span>.<span class="ruby-identifier">to_str</span>
    <span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">content</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js" integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
