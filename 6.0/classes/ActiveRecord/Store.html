<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css?family=Asap" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ActiveRecord::Store | RailsDoc(β)</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="ActiveRecord::Store" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ruby on Rails API Documentation." />
<meta property="og:description" content="Ruby on Rails API Documentation." />
<link rel="canonical" href="https://railsdoc.github.io/6.0/classes/ActiveRecord/Store.html" />
<meta property="og:url" content="https://railsdoc.github.io/6.0/classes/ActiveRecord/Store.html" />
<meta property="og:site_name" content="RailsDoc(β)" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://avatars.githubusercontent.com/u/4223" />
<meta property="twitter:title" content="ActiveRecord::Store" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Ruby on Rails API Documentation.","headline":"ActiveRecord::Store","image":"https://avatars.githubusercontent.com/u/4223","url":"https://railsdoc.github.io/6.0/classes/ActiveRecord/Store.html"}</script>
<!-- End Jekyll SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134470810-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-134470810-1');

    window.config = {
      rootPath: "/6.0/"
    }
  </script>
</head>
<body>
  <header class="navbar navbar-dark navbar-expand bg-dark flex-md-nowrap p-0 shadow sticky-header">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">RailsDoc(β)</a>
    <form class="w-100 d-none d-md-flex" action="/search" method="get">
      <input id="search-form" class="form-control form-control-dark" type="text" placeholder="Search" aria-label="Search" name="q">
    </form>

    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex px-1">
      <li class="nav-item text-nowrap p-1">
        <div class="dropdown">
          <a class="dropdown-toggle nav-link" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v6.0
          </a>
          <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="dropdownMenuLink">
            
    
    
    
        <a class="dropdown-item" href="/">v7.1</a>
    

    
    
    
        <a class="dropdown-item" href="/7.0/">v7.0</a>
    

    
    
    
        <a class="dropdown-item" href="/6.1/">v6.1</a>
    

    
    
    
        <a class="dropdown-item" href="/6.0/">v6.0</a>
    

    
    
    
        <a class="dropdown-item" href="/5.2/">v5.2</a>
    


          </div>
        </div>
      </li>
      <li class="nav-item text-nowrap p-1">
        <a class="nav-link p-2" href="https://github.com/railsdoc/railsdoc.github.io">GitHub</a>
      </li>
    </ul>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-12 col-md-3 col-xl-2 d-none d-md-block bg-light sidebar-sticky">
        <div id="navigation" class="sidebar-content">
        </div>
      </nav>

      <div class="col-12 col-md-3 col-xl-2 toc-content-sticky">
        <div class="toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#module-ActiveRecord::Store-label-Overwriting+default+accessors">Overwriting default accessors</a></li>
<li class="toc-entry toc-h2"><a href="#namespace">Namespace</a>
<ul>
<li class="toc-entry toc-h3"><a href="#module">Module</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#methods">Methods</a></li>
<li class="toc-entry toc-h2"><a href="#attributes">Attributes</a></li>
<li class="toc-entry toc-h2"><a href="#instance-private-methods">Instance Private methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#method-i-read_store_attribute">
            
              read_store_attribute(store_attribute, key)
            
          </a></li>
<li class="toc-entry toc-h3"><a href="#method-i-write_store_attribute">
            
              write_store_attribute(store_attribute, key, value)
            
          </a></li>
</ul>
</li>
</ul></div>
      </div>

      <main role="main" class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-4">
        <div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 6.0.6</span><br />
        
        <div class="type">Module</div>
        <h1>
            ActiveRecord::Store
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord/lib/active_record/store_rb.html">activerecord/lib/active_record/store.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/type/json_rb.html">activerecord/lib/active_record/type/json.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/type/serialized_rb.html">activerecord/lib/active_record/type/serialized.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="Store.html"><code>Store</code></a> gives you a thin wrapper around serialize for the purpose of storing hashes in a single column. It&#39;s like a simple key/value store baked into your record when you don&#39;t care about being able to query that store outside the context of a single record.</p>

<p>You can then declare accessors to this store that are then accessible just like any other attribute of the model. This is very helpful for easily exposing store keys to a form or elsewhere that&#39;s already built around just accessing attributes on the model.</p>

<p>Every accessor comes with dirty tracking methods (<code>key_changed?</code>, <code>key_was</code> and <code>key_change</code>) and methods to access the changes made during the last save (<code>saved_change_to_key?</code>, <code>saved_change_to_key</code> and <code>key_before_last_save</code>).</p>

<p>NOTE: There is no <code>key_will_change!</code> method for accessors, use <code>store_will_change!</code> instead.</p>

<p>Make sure that you declare the database column used for the serialized store as a text, so there&#39;s plenty of room.</p>

<p>You can set custom coder to encode/decode your serialized attributes to/from different formats. JSON, YAML, Marshal are supported out of the box. Generally it can be any wrapper that provides <code>load</code> and <code>dump</code>.</p>

<p>NOTE: If you are using structured database data types (eg. PostgreSQL <code>hstore</code>/<code>json</code>, or MySQL 5.7+ <code>json</code>) there is no need for the serialization provided by <a href="Store/ClassMethods.html#method-i-store">.store</a>. Simply use <a href="Store/ClassMethods.html#method-i-store_accessor">.store_accessor</a> instead to generate the accessor methods. Be aware that these columns use a string keyed hash and do not allow access using a symbol.</p>

<p>NOTE: The default validations with the exception of <code>uniqueness</code> will work. For example, if you want to check for <code>uniqueness</code> with <code>hstore</code> you will need to use a custom validation to handle it.</p>

<p>Examples:</p>

<pre><code>class User &lt; ActiveRecord::Base
  store :settings, accessors: [ :color, :homepage ], coder: JSON
  store :parent, accessors: [ :name ], coder: JSON, prefix: true
  store :spouse, accessors: [ :name ], coder: JSON, prefix: :partner
  store :settings, accessors: [ :two_factor_auth ], suffix: true
  store :settings, accessors: [ :login_retry ], suffix: :config
end

u = User.new(color: &#39;black&#39;, homepage: &#39;37signals.com&#39;, parent_name: &#39;Mary&#39;, partner_name: &#39;Lily&#39;)
u.color                          # Accessor stored attribute
u.parent_name                    # Accessor stored attribute with prefix
u.partner_name                   # Accessor stored attribute with custom prefix
u.two_factor_auth_settings       # Accessor stored attribute with suffix
u.login_retry_config             # Accessor stored attribute with custom suffix
u.settings[:country] = &#39;Denmark&#39; # Any attribute, even if not specified with an accessor

# There is no difference between strings and symbols for accessing custom attributes
u.settings[:country]  # =&gt; &#39;Denmark&#39;
u.settings[&#39;country&#39;] # =&gt; &#39;Denmark&#39;

# Dirty tracking
u.color = &#39;green&#39;
u.color_changed? # =&gt; true
u.color_was # =&gt; &#39;black&#39;
u.color_change # =&gt; [&#39;black&#39;, &#39;red&#39;]

# Add additional accessors to an existing store through store_accessor
class SuperUser &lt; User
  store_accessor :settings, :privileges, :servants
  store_accessor :parent, :birthday, prefix: true
  store_accessor :settings, :secret_question, suffix: :config
end
</code></pre>

<p>The stored attribute names can be retrieved using <a href="Store/ClassMethods.html#method-i-stored_attributes">.stored_attributes</a>.</p>

<pre><code>User.stored_attributes[:settings] # [:color, :homepage, :two_factor_auth, :login_retry]
</code></pre>

<h2 id="module-ActiveRecord::Store-label-Overwriting+default+accessors">Overwriting default accessors</h2>

<p>All stored values are automatically available through accessors on the Active Record object, but sometimes you want to specialize this behavior. This can be done by overwriting the default accessors (using the same name as the attribute) and calling <code>super</code> to actually change things.</p>

<pre><code>class Song &lt; ActiveRecord::Base
  # Uses a stored integer to hold the volume adjustment of the song
  store :settings, accessors: [:volume_adjustment]

  def volume_adjustment=(decibels)
    super(decibels.to_i)
  end

  def volume_adjustment
    super.to_i
  end
end
</code></pre>

    </div>
  

  

  
  


  
    <h2 id="namespace">Namespace</h2>

    
      <h3 id="module">Module</h3>
      <ul>
      
        <li><a href="Store/ClassMethods.html">ActiveRecord::Store::ClassMethods</a></li>
      
      </ul>
    

    
  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-read_store_attribute">read_store_attribute</a>
        </li>
      
        <li>
          <a href="#method-i-write_store_attribute">write_store_attribute</a>
        </li>
      
    </ul>
  

  

  
    

    

    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>local_stored_attributes</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
    
      <h2 id="instance-private-methods">Instance Private methods</h2>
      
        <div class="method">
          <h3 id="method-i-read_store_attribute">
            
              read_store_attribute(store_attribute, key)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-read_store_attribute_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/store.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_store_attribute</span>(<span class="ruby-identifier">store_attribute</span>, <span class="ruby-identifier">key</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">accessor</span> = <span class="ruby-identifier">store_accessor_for</span>(<span class="ruby-identifier">store_attribute</span>)
  <span class="ruby-identifier">accessor</span>.<span class="ruby-identifier">read</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">store_attribute</span>, <span class="ruby-identifier">key</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-write_store_attribute">
            
              write_store_attribute(store_attribute, key, value)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-write_store_attribute_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/store.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write_store_attribute</span>(<span class="ruby-identifier">store_attribute</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">accessor</span> = <span class="ruby-identifier">store_accessor_for</span>(<span class="ruby-identifier">store_attribute</span>)
  <span class="ruby-identifier">accessor</span>.<span class="ruby-identifier">write</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">store_attribute</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>

        <footer class="site-footer">
          <!-- <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span> -->
        </footer>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js" integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/search.js"></script>
</body>
</html>
